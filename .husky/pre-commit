#!/bin/sh

# Format files and re-stage any formatted changes
echo "‚ú® Formatting code..."
STAGED_FILES=$(git diff --cached --name-only)
if ! trunk fmt >/dev/null 2>&1; then
	echo "‚ùå Code formatting failed. Run 'trunk fmt' to see details."
	exit 1
fi
if [ -n "${STAGED_FILES}" ]; then
	echo "${STAGED_FILES}" | xargs git add
fi

# Run linter with auto-fix and re-stage any fixes
echo "üîç Running linter checks..."
if ! trunk check --fix >/dev/null 2>&1; then
	echo "‚ùå Linting failed. Run 'trunk check' to see errors and fix them."
	exit 1
fi
if [ -n "${STAGED_FILES}" ]; then
	echo "${STAGED_FILES}" | xargs git add
fi

echo "‚úÖ All pre-commit checks passed!"
